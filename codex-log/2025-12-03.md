# Codex Log — 2025-12-03

## Step 1
- Added per-state filtering and batching in the property import pipeline; switched Dynamo ingestion to `outreach = 0` via the `state_outreach` GSI and mark processed items to `outreach = 1`.
- Batched property/listing upserts to speed imports and made status mandatory for processing; status mapping includes `FOR_SALE_AGAIN` → `FOR_SALE` and `COMING_SOON`.
- Added base enrichment entity (`PropertyBaseEnrichment`) with a one-to-one eager link from `Property`, registered it with TypeORM, and provided a repository; removed legacy `initialScrapeStatus` from `Property`.
- Expanded `Property` fields (lot area unit/value, URL, living area fallback) and mapped them from Dynamo inputs.
- Added admin stats endpoints:
  - `POST /admin/properties/stats/summary` for totals and counts by status/state.
  - `POST /admin/properties/stats/state-breakdown` for paginated per-state counts (FOR_SALE/PENDING/COMING_SOON), including requested states even when zero; supports `limit`/`offset` and filters.
- Documented summary/breakdown responses via DTOs and kept state breakdown aggregation per state (not per-status rows).

## Step 2
- Kept `parcelId` on `PropertyBaseEnrichment` and added `has3DModel`, `imgSrc`, and `brokerName` directly on `Property` to match Dynamo payloads.
- Removed `initialScrape`/`propertyTypeDimension` from `Property` and stopped setting `initialScrape` in import flows.
- Updated Dynamo import mapping to pull `daysOnZillow`/`timeOnZillow` (with `hdpData.homeInfo` fallback), cast `has3DModel` to boolean, and populate `imgSrc`/`brokerName` on `Property`; property import no longer touches base enrichment (parcelId handled via separate enrichment flow).

## Step 3
- Added a one-time backfill script to hydrate `url`, `livingAreaValue`, `lotAreaUnit`, `lotAreaValue`, `has3DModel`, `imgSrc`, and `brokerName` from Dynamo via `zpid`.
- Extended Dynamo service with `getLatestByPrimaryKey` (query by PK, latest sort key) to handle composite PK/SK tables when GetItem fails; backfill script falls back to this.
